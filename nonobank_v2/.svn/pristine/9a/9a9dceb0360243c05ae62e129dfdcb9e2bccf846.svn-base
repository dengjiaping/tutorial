<?xml version="1.0" encoding="UTF-8"?>
<!--
  ~ Copyright (c) 2009-2014. 上海诺诺镑客 All rights reserved.
  ~ @(#) spring-mvc.xml 2014-10-27 16:42
  -->

<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:util="http://www.springframework.org/schema/util"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd">

    <util:properties id="freemarkerProperties" location="classpath:freemarker.properties" />

    <import resource="classpath:/META-INF/spring/default-spring-mvc.xml" />

    <bean id="handlerMapping" class="org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping" />

    <bean id="sortResolver" class="org.springframework.data.web.HateoasSortHandlerMethodArgumentResolver" />
    <bean id="pageableResolver" class="org.springframework.data.web.HateoasPageableHandlerMethodArgumentResolver">
        <constructor-arg ref="sortResolver" />
    </bean>
    <bean id="pagedResourcesAssembler" class="org.springframework.data.web.PagedResourcesAssembler">
        <constructor-arg index="0" ref="pageableResolver" />
        <constructor-arg index="1"><null /></constructor-arg>
    </bean>
    <bean id="pagedResourcesAssemblerArgumentResolver" class="org.springframework.data.web.PagedResourcesAssemblerArgumentResolver">
        <constructor-arg index="0" ref="pageableResolver" />
        <constructor-arg index="1"><null /></constructor-arg>
    </bean>

    <bean class="org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter">
        <property name="order" value="1" />
        <property name="customArgumentResolvers">
            <list>
                <ref bean="sortResolver" />
                <ref bean="pageableResolver" />
                <ref bean="pagedResourcesAssemblerArgumentResolver" />
            </list>
        </property>
        <property name="messageConverters">
            <array>
                <bean class="org.springframework.http.converter.ByteArrayHttpMessageConverter" />
                <ref bean="stringHttpMessageConverter" />
                <bean class="org.springframework.http.converter.xml.SourceHttpMessageConverter" />
                <bean class="com.nonobank.http.converter.SimpleFormHttpMessageConverter" />
                <bean class="com.nonobank.http.converter.json.SimpleJackson2HttpMessageConverter" />
            </array>
        </property>
    </bean>

    <context:component-scan base-package="com.nonobank.user.web, com.nonobank.web.annotation" use-default-filters="false">
        <context:include-filter type="annotation" expression="org.springframework.stereotype.Controller" />
        <context:include-filter type="annotation" expression="org.springframework.web.bind.annotation.ControllerAdvice" />
    </context:component-scan>

    <bean id="freemarkerConfiguration" class="org.springframework.beans.factory.config.PropertiesFactoryBean">
        <property name="properties" ref="freemarkerProperties"/>
    </bean>

    <bean id="freemarkerConfig" parent="abstractFreeMarkerConfigurer">
        <property name="freemarkerVariables">
            <map>
                <entry key="xml_escape" value-ref="fmXmlEscape"/>
            </map>
        </property>
        <property name="templateLoaderPath" value="/WEB-INF/views"/>
        <property name="freemarkerSettings" ref="freemarkerConfiguration"/>
        <!--<property name="preTemplateLoaders">
            <array>
                <bean class="freemarker.cache.ClassTemplateLoader">
                    <constructor-arg index="0" value="com.tonglukuaijian.survey.config.DefaultAppConfig"/>
                    <constructor-arg index="1" value="/META-INF/templates"/>
                </bean>
            </array>
        </property>-->
    </bean>
</beans>